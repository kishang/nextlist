!function(t,e){function n(e){t.fn.nextlist.debugMode&&t.error("Nextlist: "+e)}function i(n,i,s){var a=i.data("nextlist.settings"),o=t(t.parseHTML("<li>")),d=t(t.parseHTML('<span class="nextlist-item-text">'))
o.data("nextlist.nextwebNode",n),o.addClass(a.listItemClassName),a.listItemPrefix&&o.append(t.parseHTML(a.listItemPrefix)),d.text(n.getValue()),o.append(d),a.listItemSuffix&&o.append(t.parseHTML(a.listItemsuffix)),s!==e?i.children().eq(s).before(o):i.append(o)}function s(n,i){var s=n.data("nextlist.nPendingChanges")||0
s++,n.data("nextlist.nPendingChanges",s),n.trigger("nextlist.change"),n.data("nextlist.settings").nextwebSession.commit().get(function(){var s=n.data("nextlist.nPendingChanges")||0
s--,n.data("nextlist.nPendingChanges",Math.max(s,0)),0>=s&&(n.trigger("nextlist.commit"),d(n)),i!==e&&t.isFunction(i)&&i.call(n)})}function a(t,e,n,i){var s=i.seed()
return s.setValue(t),n.insert(s,e),s}function o(t){t.sortable("refresh")}function d(n,s){var a=n.data("nextlist.settings")
a.nextwebSession.node(a.nextwebNodeAddress,a.nextwebNodeSecret).get(function(a){n.data("nextlist.nextwebNode",a),a.selectAll().get(function(a){n.empty(),a.each(function(t){i(t,n)}),o(n),s!==e&&t.isFunction(s)&&s.call(n)})})}function l(t,n){var i,s=t.data("nextlist.settings")
t.data("nextlist.nextwebNode")&&r(t),i=t.data("nextlist.nextwebNode").monitor(),i.addListener(function(){t.data("nextlist.nPendingChanges")<=0&&d(t)}),n!==e?(s.nextwebMonitorInterval=n,t.data("nextlist.settings",s)):n=s.nextwebMonitorInterval,i.setInterval(n),i.get(function(e){t.data("nextlist.nextwebMonitor",e)})}function r(t){var e=t.data("nextlist.nextwebMonitor")
e&&(t.data("nextlist.nextwebMonitor",!1),e.stop().get())}var x={nextwebSession:null,nextwebNodeAddress:null,nextwebNodeSecret:null,autoStartMonitoring:!0,nextwebMonitorInterval:"FAST",listItemClassName:"ui-state-default",listItemPrefix:"",listItemSuffix:""},u={}
u.load=function(t,e){var i
return t?e?(i=this.data("nextweb.settings"),i.nextwebNodeAddress=t,i.nextwebNodeSecret=e,this.data("nextweb.settings",i),d(this),this.data("nextlist.nextwebMonitor")&&(r(this),l(this)),void 0):(n("Invalid Nextweb node secret specified"),void 0):(n("Invalid Nextweb node address specified"),void 0)},u.reload=function(){d(this)},u.getSession=function(){return this.data("nextlist.settings").nextwebSession},u.startMonitor=function(t){l(this,t)},u.stopMonitor=function(){r(this)},t.fn.nextlist=function(i){var o,r=this.eq(0).filter("ul:data(ui-sortable), ol:data(ui-sortable)")
return r.length?u[i]?r.data("nextlist.settings")?u[i].apply(r,Array.prototype.slice.call(arguments,1)):(n("Cannot invoke method before Nextlist initialization"),void 0):r.data("nextlist.settings")?(n("Nextlist has already been initialized for this element"),void 0):(o=t.extend({},x,i),o.nextwebSession||Nextweb&&Nextweb.createSession?o.nextwebSession&&!o.nextwebSession.seed?n("A valid Nextweb session was not sepcified"):t.fn.sortable===e?n("jQuery UI Sortable is not available"):o.nextwebNodeAddress?o.nextwebNodeSecret?(o.nextwebSession||(o.nextwebSession=Nextweb.createSession()),r.data({"nextlist.settings":o,"nextlist.nPendingChanges":0}),d(r,function(){o.autoStartMonitoring&&l(r)}),r.on({sortstart:function(t,e){e.item.data({"nextlist.originalParent":e.item.parents("ul").get(0),"nextlist.originalIndex":e.item.index()})},sortstop:function(t,e){if(e.item.data("nextlist.originalParent")===e.item.parents("ul").get(0)){var n,i=r.data("nextlist.nextwebNode")
if(e.item.data("nextlist.originalIndex")===e.item.index())return
i.shield().remove(e.item.data("nextlist.nextwebNode")),n=a(e.item.find("span.nextlist-item-text").text(),e.item.index(),i,r.data("nextlist.settings").nextwebSession),s(r,function(){e.item.data("nextlist.nextwebNode",n.get())})}},sortremove:function(e,i){t(i.item.parents("ul").get(0)).data("nextlist.settings")||n("Nextlist has not been initialized for the destination list")},sortreceive:function(e,i){var o,d=t(i.item.data("nextlist.originalParent"))
return d.data("nextlist.settings")?(d.data("nextlist.nextwebNode").remove(i.item.data("nextlist.nextwebNode")),o=a(i.item.find("span.nextlist-item-text").text(),i.item.index(),r.data("nextlist.nextwebNode"),r.data("nextlist.settings").nextwebSession),s(d),s(r,function(){i.item.data("nextlist.nextwebNode",o.get())}),void 0):(n("Nextlist has not been initialized for the source list"),void 0)}})):n("A valid Nextweb node secret was not specified"):n("A valid Nextweb node address was not specified"):n("Nextweb object not found"),this):(n("Invalid selection. The first element must be either an <ul> or an <ol> element and must have jQuery UI Sortable initialized"),void 0)},t.fn.nextlist.debugMode=!1}(jQuery)